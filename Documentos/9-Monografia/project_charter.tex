\chapter{Introdução}

O projeto apresentado neste documento trata-se do “Mapeamento de Ambientes com o robô Bellator” e é uma extensão do projeto “Bellator”. Ele teve sua última alteração em 2012 quando foi utilizado por Alexandre Jacques Marin, Júlio Cesar Nardelli Borges e Yuri Antin Wergrzn como plataforma de experimentos para o projeto final de conclusão de curso. O projeto para a disciplina de Oficina de Integração 3 foi desenvolvido com base nesse robô. Na versão anterior dele, estava presente um conjunto de circuitos (com um microcontrolador) que gerenciava as operações de baixo nível. Além disso, estava presente um PC embarcado (executando o sistema Linux), que efetuava as operações de alto nível.
A equipe deste projeto propôs modificar o robô Bellator para efetuar o mapeamento 2D de ambientes controlados como, por exemplo, corredores, escritórios e salas.

Na versão anterior do Bellator, estavam sendo utilizadas duas placas de circuito impresso – uma integrada com o microcontrolador e uma para a interface com os sensores – ambas ligadas por cabos entre si. Ao invés de produzir uma terceira placa para sensores adicionais (aspecto explicado mais à frente), o que aumentaria a quantidade de cabos, foi proposto o desenvolvimento de uma nova placa que realizasse a função de interface com todos os sensores e que fosse acoplada ao microcontrolador. Este microcontrolador pode ser usado diretamente na forma encapsulada de circuito integrado (soldado diretamente na nova placa), ou integrado a um kit de desenvolvimento (acoplado como \textit{shield} na nova placa).

O sistema embarcado do robô desenvolvido pela equipe consiste na placa de interface de sensores acoplada ao microcontrolador. Esse sistema realiza as funções de baixo nível, ou seja, leitura de sensores e controle do PWM dos motores. A estação base é um computador, provido de um software que efetua comunicação bidirecional com o robô. A estação é capaz de enviar comandos de movimentação (especificados manualmente pelo teclado) a ele, além de receber imagens da câmera e leituras dos sensores. No software, a partir das leituras dos sensores, é produzido um mapa em 2D simplificado do ambiente, com os obstáculos que forem detectados à medida que o robô anda, além do caminho estimado percorrido por ele. Protocolos de comunicação são utilizados entre: circuito de baixo nível e o PC embarcado (através de porta serial), e entre PC embarcado e estação base (através de conexão WI-FI). A placa com sistema linux embarcado foi mantida. Ela serve de interface entre a estação-base e a placa de controle embarcada e possui duas entradas USB. Em uma delas foi colocado um dispositivo de comunicação WI-FI, uma vez que a conexão entre a estação base e o robô têm um alcance de até 20 metros e a tecnologia WI-FI se mostra adequada para a comunicação dentro desse limite de distância. À outra porta foi acoplada uma webcam de forma a permitir que o usuário na estação base acompanhe a movimentação do robô à distância.

Um aspecto importante a ser notado é a exatidão e confiabilidade das medições de velocidade. No robô anterior havia somente dois encoders, um para cada roda – a partir dos quais pode ser medida a velocidade e distância percorrida. Há certas desvantagens em utilizar essa abordagem, que são principalmente as questões de exatidão. Por exemplo, caso alguma roda escorregue, gire em falso ou sofra trepidações, as medições podem ser comprometidas – gerando distorções no mapa 2D. Por isso, instalou-se novos sensores na carcaça do robô (acelerômetro e giroscópio) para adicionar maior confiabilidade nas medições do sistema – tendo em vista que esses sensores mensuram o movimento real do robô e não somente o giro das rodas. Dessa forma, teoricamente, poderia se ter uma maior garantia de exatidão nos mapas gerados, levando-se em conta que a velocidade e posição do robô seriam melhor determinados. Especialmente em trabalhos futuros, se o robô for utilizado em ambientes acidentados ou em condições não ideais de terreno, esses sensores podem ser de grande valia – uma vez que nesses ambientes há maior chance da as rodas escorregarem, girarem em falso ou trepidarem.

Esta monografia está organizada da seguinte forma: os capítulos 2 e 3 abordam os objetivos a serem explorados e o escopo do projeto. No quarto capítulo é feita a apresentação dos membros da equipe e do gerente. Os capítulos 5 e 6 relatam as pesquisas efetuadas antes de se iniciar o desenvolvimento do projeto. Mais especificamente, o capítulo 5 apresenta abordagens semelhantes encontradas e o capítulo 6 consiste de uma análise detalhada de alternativas tecnológicas possíveis de serem utilizadas e justifica as escolhas tecnológicas feitas. Os capítulos 7 e 8 tratam do planejamento traçado para a realização do projeto, incluindo as tarefas a serem realizadas, os responsáveis por elas, os prazos e os custos totais envolvidos. A seguir é discutido o desenvolvimento do projeto: no capítulo 9 é mostrada a modelagem UML da estação-base e do servidor linux embarcado, a questão dos protocolos de comunicação também é abordada; no capítulo 10 discute-se o hardware desenvolvido, desde seus diagramas até sua confecção em circuito impresso e montagem. 

Os capítulos 11 a 13 tratam dos resultados obtidos. No capítulo 11 faz-se a introdução da interface gráfica da estaço-base. No capítulo 12 é feita a fundamentação teórica da geração dos mapas a partir da leitura dos encoders ópticos das rodas. No capítulo 13 é feita a apresentação dos três testes efetuados para validação dos resultados obtidos. O capítulo 14 apresenta as conclusões e observações. No capítulo 15 são feitas sugestões de melhorias e de projetos futuros que podem ser desenvolvidos com base no presente trabalho. Por último, o anexo A apresenta o planejamento de riscos contendo eventuais falhas que poderiam ocorrer durante a realização do projeto e o anexo B contém as dimensões físicas do robô.

A realização deste trabalho teve a duração total de 10 semanas entre seu planejamento inicial, desenvolvimento, testes e documentação.

\chapter{Especificação de Objetivos}
OBJETIVOS:

\begin{itemize}
  \item Implementar um software para comunicação de uma estação base (computador) com o robô, de forma que ela possa enviar comandos de movimentação ao robô, além de receber imagens da câmera e leituras dos sensores. Os comandos de movimentação (mover para frente, para trás, girar para esquerda/direita, parar) serão especificados por um utilizador humano através do teclado da estação base. 
  \item O meio de comunicação entre a estação base e o robô deverá ter alcance máximo de 20 m (se não houverem paredes ou obstáculos entre a estação base e o robô). Para isso a tecnologia WI-FI mostra-se adequada e, portanto, ela será utilizada.
  \item Inserir uma \textit{webcam} USB no robô, de modo que imagens do ambiente possam ser transmitidas à estação base. O propósito das imagens será unicamente permitir a visualização (pelo usuário da estação base, em tempo real) do ambiente no qual o robô está localizado. A câmera será conectada na porta USB do computador embarcado, e a transmissão de imagens será feita pelo canal Wi-Fi entre a estação base e o robô (o mesmo canal utilizado para a transmissão de dados dos sensores e comandos de movimentação).
  \item Implementar, no software utilizado na estação base, a geração de uma mapa em 2D com o caminho estimado percorrido pelo robô e os obstáculos detectados pelo mesmo. Os obstáculos serão representados a partir dos pontos em que houve detecção pelos sensores.
  \item Instalar novos sensores (acelerômetro e giroscópio) para efetuar as medições de velocidade e posicionamento do robô com maior exatidão do que pode ser feito atualmente com os \textit{encoders}. Ambos os sensores serão posicionados na carcaça do robô. Caso discrepâncias de medição entre os \textit{encoders}, acelerômetro e giroscópio sejam detectadas (por exemplo, em caso de escorregamento de rodas), atenuações de erros poderão ser feitas no \textit{software} da estação base.
%  A velocidade e deslocamento lineares instantâneos serão determinados a partir da integração numérica da aceleração linear (cujas amostras serão obtidas com o acelerômetro em intervalos de tempo discretos). A velocidade e deslocamento angular instantâneos serão determinados a partir da integração numérica da aceleração angular (cujas amostras serão obtidas com o giroscópio em intervalos de tempo discretos). A posição atual do robô será gradualmente atualizada na representação do mapa à medida em que as amostras de aceleração linear e angular forem recebidas na estação base.
  \item Desenvolver uma placa de circuito impresso que realize a função de interface com os sensores e que seja acoplada ao microcontroldador. Este microcontrolador pode ser usado diretamente na forma encapsulada de circuito integrado (sendo soldado diretamente na nova placa) ou integrado a um kit de desenvolvimento (acoplado como \textit{shield} na nova placa).
  \item Em caso de falha de comunicação entre o robô e a estação base, o robô deverá permanecer parado e aguardando a conexão ser reestabelecida.
\end{itemize}

\chapter{Premissas e restrições}
PREMISSAS:
\begin{itemize}
  \item Por ser utilizado o robô Bellator que já provém de trabalhos anteriores, infere-se que não haverá necessidade de haver gastos de tempo com consertos de equipamentos defeituosos ou correções de bugs no código fonte. Parte-se do pressuposto que o robô funciona de acordo com o que foi exposto nos relatórios anteriores.
  \item O robô é capaz de detectar obstáculos (paredes e objetos fixos de tamanho considerável que sejam maiores que ele) através dos sensores. A distância mínima para detecção é de 20cm e a máxima de 150cm.
  \item O robô é capaz de locomover-se em terrenos planos, não acidentados e em condições não severas.
  \item Pressupõe-se que o robô será disponibilizado para a equipe sem custos.
Podem ser utilizados os equipamentos e componentes diversos que já estejam disponíveis, com o objetivo de redução de custos.
\end{itemize}

RESTRIÇÕES:
\begin{itemize}
  \item O tempo disponível para a equipe é limitado, portanto muita atenção será dada às fases de planejamento e testes iniciais de modo a evitar imprevistos.
  \item A equipe deverá seguir um calendário previamente estabelecido, tendo o objetivo de evitar atrasos.
  \item O robô não será capaz de se locomover em terrenos acidentados, em escadas e similares.
  \item O robô não transportará cargas.
  \item O robô e a estação base não executarão algoritmos de roteamento ou mapeamento autônomo de ambientes. O controle de movimentação deverá ser feito obrigatoriamente por um usuário humano junto à estação base. O robô não fará nenhuma movimentação automática em caso de falha de conexão. Ele permanecerá parado aguardando a conexão ser reestabelecida.
  \item O robô e a estação base não serão capazes de efetuar mapeamento 3D.
  \item O robô e a estação base não irão armazenar automaticamente fotos ou vídeos dos ambientes explorados.
  \item O robô e o ponto de acesso WI-FI da estação base devem estar a uma distância máxima de 20 metros um do outro (supondo que não hajam paredes ou obstáculos). Caso contrário, não haverá garantias de que a comunicação entre a estação base e o robô seja funcional.
  \item Não serão usadas imagens do ambiente para a geração dos mapas.
  \item Os obstáculos não serão identificados quanto ao tipo ou forma. Serão apenas detectados pela sua presença.
\end{itemize}

\chapter{Designação do Gerente e da Equipe}
A equipe consiste de cinco integrantes: Pedro Alberto de Borba, Ricardo Farah, Stefan Campana Fuchs e Telmo Friesen e Luis Guilherme Machado Camargo, tendo este último sido o gerente.
